<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[KayaMemo]]></title>
  <link href="http://kayakuguri.github.io/atom.xml" rel="self"/>
  <link href="http://kayakuguri.github.io/"/>
  <updated>2014-04-23T16:49:44+09:00</updated>
  <id>http://kayakuguri.github.io/</id>
  <author>
    <name><![CDATA[萱潜]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[SalesForce]メールテンプレートの項目一覧]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/04/23/sf-mailtemplate/"/>
    <updated>2014-04-23T16:39:55+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/04/23/sf-mailtemplate</id>
    <content type="html"><![CDATA[<p>メールテンプレートは、<code>SOQL</code>を使用して、<code>EmailTemplate</code>でとってこれる。</p>

<!-- more -->


<p>参考：<a href="https://developer.salesforce.com/forums?id=906F00000009BOlIAM">https://developer.salesforce.com/forums?id=906F00000009BOlIAM</a></p>

<p>取得した<code>EmailTemplate</code>の一覧<br/>
(内容は間違っている可能性があります)</p>

<table>
<thead>
<tr>
<th>項目名 </th>
<th> 内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>body </td>
<td> 本文</td>
</tr>
<tr>
<td>markup </td>
<td> </td>
</tr>
<tr>
<td>folderid </td>
<td> フォルダーのID</td>
</tr>
<tr>
<td>subject </td>
<td> 件名</td>
</tr>
<tr>
<td>developername </td>
<td> 作成者</td>
</tr>
<tr>
<td>timesused </td>
<td> 使用回数</td>
</tr>
<tr>
<td>createddate </td>
<td> 作成日</td>
</tr>
<tr>
<td>ownerid </td>
<td> オーナーのID</td>
</tr>
<tr>
<td>apiversion </td>
<td> </td>
</tr>
<tr>
<td>createdbyid </td>
<td> 作成者のID</td>
</tr>
<tr>
<td>lastmodifieddate </td>
<td> 更新日</td>
</tr>
<tr>
<td>id </td>
<td> ID</td>
</tr>
<tr>
<td>brandtemplateid </td>
<td> </td>
</tr>
<tr>
<td>lastuseddate </td>
<td> 最終使用日</td>
</tr>
<tr>
<td>templatestyle </td>
<td> </td>
</tr>
<tr>
<td>isactive </td>
<td> 有効か</td>
</tr>
<tr>
<td>namespaceprefix </td>
<td> </td>
</tr>
<tr>
<td>description </td>
<td> テンプレートの説明</td>
</tr>
<tr>
<td>name </td>
<td> テンプレートの一意の名前</td>
</tr>
<tr>
<td>templatetype </td>
<td> テンプレートのタイプ</td>
</tr>
<tr>
<td>encoding </td>
<td> 文字コード</td>
</tr>
<tr>
<td>systemmodstamp </td>
<td> </td>
</tr>
<tr>
<td>lastmodifiedbyid </td>
<td> 更新者のID</td>
</tr>
<tr>
<td>htmlvalue </td>
<td> HTMLテンプレートの場合の本文</td>
</tr>
</tbody>
</table>


<hr />

<p>以下の方法でオブジェクトの項目一覧を取得出来る。</p>

<p>参考：<br/>
<a href="http://techblog.appirio.co.jp/2012/07/forcecom-apexdescribe.html">http://techblog.appirio.co.jp/2012/07/forcecom-apexdescribe.html</a><br/>
<a href="http://www30304u.sakura.ne.jp/blog/?p=188">http://www30304u.sakura.ne.jp/blog/?p=188</a><br/>
<a href="http://vaindespair.blogspot.jp/2012/04/blog-post_04.html">http://vaindespair.blogspot.jp/2012/04/blog-post_04.html</a></p>

<p>実際に取得したapexコード</p>

<pre><code>public Pagereference getList() {
    sObject newObj = (sObject)Type.forName('EmailTemplate').newInstance();
    Schema.DescribeSObjectResult descResult = newObj.getsObjectType().getDescribe();
    String keys = concatSet(descResult.fields.getMap().keySet(), ', ');

    System.debug('***** EmailTemplate keys: ' + keys);
}

private static String concatSet(Set&lt;String&gt; strSet, String sep) {
    String retStr;
    for (String str : strSet) {
        retStr = retStr == null ? str : retStr + sep + str;
    }
    return retStr == null ? '' : retStr;
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[SaleseForce]匿名ブロックでの実行テスト]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/04/23/sf-anonymous-debug/"/>
    <updated>2014-04-23T16:17:04+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/04/23/sf-anonymous-debug</id>
    <content type="html"><![CDATA[<p>特定のメソッドを実行してデバッグ出力を確認したいときに、<br/>
そのメソッドだけ単発で実行させる方法として、<code>匿名ブロック</code>による実行というのがある。</p>

<!-- more -->


<p>参考：<a href="http://blog.livedoor.jp/rays4live/archives/67722528.html">Apexプログラミング～基本編２～</a></p>

<p>基本、上記参考サイトの通り。<br/>
Force.com IDE上でも匿名ブロック、<code>Execute Anonymous</code>での実行が出来る。</p>

<blockquote><p>Execute Anonymous」の機能を使います。この機能は、「匿名ブロック」と呼ばれていて、単発でメソッドの呼び出しなどを行うことができます。一種のコンソール的なものとイメージするといいかと思います。</p></blockquote>

<p>VisualForceのページから呼び出す用のクラスを実行する場合は、<br/>
テストクラスを書くときと同じ要領で、クラスをnewして実行させる。<br/>
例えば、そのページがLeadを標準のコントローラーとしている時は以下のように。<br/>
<code>testMethod</code>が実行したい関数だとする。
(別にページでLeadに指定していても他のオブジェクトを渡しても問題ない)</p>

<pre><code>Lead p = new Lead();
HogeController c = new HogeController(new ApexPages.StandardController(p));
c.testMethod();
</code></pre>

<p>で、<code>testMethod</code>内には以下のように書いていたとする。</p>

<pre><code>public Pagereference testMethod() {
    System.debug('Hello world!');
    return null;
}
</code></pre>

<p>実行後、ログが出力されて、目的のデバッグログも以下のような形で吐かれる。</p>

<pre><code>15:11:05.049 (49728000)|USER_DEBUG|[46]|DEBUG|Hello world!
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PhpstormでRubyファイルにシンタックスハイライトを適用]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/04/04/phpstorm-ruby/"/>
    <updated>2014-04-04T13:39:21+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/04/04/phpstorm-ruby</id>
    <content type="html"><![CDATA[<p>シンタックスハイライトや補完なんかはやっぱりphpstormでは無理なよう。<br/>
通常は、<code>IntelliJ IDEA Ultimate</code>使え、と。<br/>
とはいえ、基本的なシンタックスハイライトくらいは適応させる方法がある、とのこと。</p>

<!-- more -->


<p><a href="http://stackoverflow.com/questions/16451359/is-it-possible-to-get-ruby-syntax-highlighting-in-phpstorm">Is it possible to get Ruby syntax highlighting in PHPStorm?</a></p>

<p>基本は上記の訳。</p>

<p>1) <a href="https://github.com/drnic/ruby-tmbundle">ruby-tmbundle</a>を適当なディレクトリにクローン。</p>

<pre><code>$ git clone https://github.com/drnic/ruby-tmbundle.git
</code></pre>

<p>2) <code>Phpsotrm -&gt; Preference</code>を開く<br/>
<code>IDE Settings</code>以下にある、<code>TextMate Bundles</code>に1)のディレクトリを追加。</p>

<p><img src="http://kayakuguri.github.io/images/2014/04/phpstorm-ruby1.jpg" alt="TextMate Bundles" /></p>

<p>3) 諸々の理由で、このバンドルはrubyの<code>rb</code>ファイルをサポートしていないらしい。<br/>
なので、サポートするように修正する。<br/>
1)のディレクトリ内の、<code>ruby-tmbundle/Syntaxes/Ruby.plist</code>を開く。<br/>
その中で、<code>&lt;key&gt;fileTypes&lt;/key&gt;</code>以下にある、<code>&lt;array&gt;</code>タグの中に<code>&lt;string&gt;rb&lt;/string&gt;</code>を追加する。</p>

<pre><code>...
&lt;key&gt;fileTypes&lt;/key&gt;
&lt;array&gt;
    &lt;string&gt;rb&lt;/string&gt; ←追加
    &lt;string&gt;rbx&lt;/string&gt;
    &lt;string&gt;Rakefile&lt;/string&gt;
    &lt;string&gt;rake&lt;/string&gt;
    &lt;string&gt;sake&lt;/string&gt;
    &lt;string&gt;cgi&lt;/string&gt;
    &lt;string&gt;fcgi&lt;/string&gt;
    &lt;string&gt;gemspec&lt;/string&gt;
    &lt;string&gt;irbrc&lt;/string&gt;
    &lt;string&gt;capfile&lt;/string&gt;
&lt;/array&gt;
&lt;key&gt;firstLineMatch&lt;/key&gt;
…
</code></pre>

<p>4) <code>Preference</code>で、<code>File Types</code>で、<code>*.rb</code>を追加が追加されていることを確認する。</p>

<p><img src="http://kayakuguri.github.io/images/2014/04/phpstorm-ruby2.jpg" alt="File Types" /></p>

<p>完了。</p>

<p><img src="http://kayakuguri.github.io/images/2014/04/phpstorm-ruby3.jpg" alt="Ruby syntax highlight" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[バッチファイルでのFTPアップロード]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/04/03/ftp-upload-bat/"/>
    <updated>2014-04-03T17:41:46+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/04/03/ftp-upload-bat</id>
    <content type="html"><![CDATA[<p>バッチファイルでFTPに接続して何かをする場合、<br/>
バッチファイルとは別に、接続先や作業内容などを記述したコマンドファイルが必要になる。<br/>
それを、バッチファイルから呼び出す形。</p>

<!-- more -->


<p>とはいえ、このコマンドファイルも実行するバッチファイル内で作成してしまい、<br/>
それを保存、実行、削除、してしまえば、ファイルが一つで動作できるようになる。</p>

<ol>
<li>コマンドファイルを、tmpファイルとしてまず作成し、</li>
<li>それをバッチで実行し、</li>
<li>tmpファイルを削除</li>
</ol>


<p>コマンドファイルは中身がテキストであればなんでも大丈夫なよう。</p>

<p>実行するコマンドファイルは一つだけれど、<br/>
便宜上、３つのファイルを作成し、それらを合体させて一つのファイルにするフローにした。</p>

<p>作成されるファイル</p>

<ol>
<li>ftp_login.tmp</li>
<li>ftp_up.tmp</li>
<li>ftp_loguot.tmp</li>
<li>ftp_bat.tmp</li>
</ol>


<p>1) ftpのログイン情報</p>

<pre><code>open [サーバー名]
[ユーザー名]
[パスワード]
bin
prompt
</code></pre>

<p><code>bin</code>以降に処理を書く。<br/>
<code>prompt</code>、は複数のファイルをアップロードやダウンロードする際に、確認を求められるのでそれを回避するために入れている。</p>

<p>2) アップロード情報</p>

<pre><code>cd /home/hoge
mput *.html
</code></pre>

<p>アップするディレクトに移動して、アップロード。<br/>
<code>put</code>がアップロード、で、<code>m</code>をつけると複数ファイルの処理になる。<br/>
(<code>m</code>をつけた場合のみ確認が出るので、それを出さないために<code>prompt</code>を入れている)</p>

<p>3) ログアウト情報</p>

<pre><code>bye
close
</code></pre>

<p><code>bye</code> : FTP終了<br/>
<code>close</code> : 接続を切断</p>

<p>4) 1〜3の内容をまとめて一つにする。</p>

<p>実行方法</p>

<pre><code>ftp -s:ftp_bat.tmp
</code></pre>

<p>ログを残す場合は以下。</p>

<pre><code>ftp -s:ftp_bat.tmp&gt;&gt;upload.log
</code></pre>

<hr />

<p>今回調べた(全然知らなかったので)コマンドは以下。</p>

<table>
<thead>
<tr>
<th>コマンド </th>
<th> 説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@echo off </td>
<td> 以降の実行するコマンドを画面に表示させないようにする</td>
</tr>
<tr>
<td>set </td>
<td> 変数を定義</td>
</tr>
<tr>
<td>rem </td>
<td> コメント</td>
</tr>
<tr>
<td>% </td>
<td> 変数を参照 <code>%file%</code>、<code>%TEMP%</code>など</td>
</tr>
<tr>
<td>%cd% </td>
<td> 現在のディレクトリ</td>
</tr>
<tr>
<td>:[ラベル] </td>
<td> ラベルを設定</td>
</tr>
<tr>
<td>goto [ラベル] </td>
<td> 指定したラベルへ移動</td>
</tr>
<tr>
<td>> </td>
<td> 左側に書いたものを右側のファイルへ書き込む(新規 もしくは 上書き)</td>
</tr>
<tr>
<td>>> </td>
<td> 左側に書いたものを右側のファイルへ追記</td>
</tr>
<tr>
<td>type </td>
<td> テキストファイルの中身をそのまま画面に出力</td>
</tr>
<tr>
<td>cscript </td>
<td> 指定したスクリプトの実行</td>
</tr>
</tbody>
</table>


<p>ファイルへの書き込み方法は、以下。</p>

<pre><code>//直接記入
echo hoge&gt; test.txt
--内容
hoge
//直接追記
echo fuga&gt;&gt; test.txt
--内容
hoge
fuga
//ファイル内容を記入
type test.txt&gt; sample.txt
--内容
hoge
fuga
//ファイル内容を追記
type test.txt&gt;&gt; sample.txt
--内容
hoge
fuga
hoge
fuga
</code></pre>

<hr />

<p>全体は以下のような形。<br/>
指定したサーバーに、同階層にあるhtml拡張子のファイルをアップロードする。<br/>
ログは、同階層に、<code>upload.log</code>に記録。</p>

<pre><code>@echo off
set path_local=%cd%
set path_remote=/home/uploadset
server=[ホスト名]
set user=[ユーザー名]
set password=[パスワード]

set ftplogin=ftp_login.tmp
set ftplogout=ftp_logout.tmp
set ftpupload=ftp_up.tmp
set ftpbat=ftp_bat.tmp

echo %user%&gt; %ftplogin%
echo %password%&gt;&gt; %ftplogin%
echo bin&gt;&gt; %ftplogin%
echo prompt&gt;&gt; %ftplogin%

echo cd %path_remote%&gt;&gt; %ftpupload%
echo mput *.html&gt;&gt; %ftpupload%

echo bye&gt; %ftplogout%
echo close&gt;&gt; %ftplogout%

echo open %server%&gt;%ftpbat%
type %ftplogin%&gt;&gt;%ftpbat%
type %ftpupload%&gt;&gt;%ftpbat%
type %ftplogout%&gt;&gt;%ftpbat%

ftp -s:%ftpbat% &gt;upload.log

del %ftplogin%
del %ftplogout%
del %ftpupload%
del %ftpbat%
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sublimetext3をWindows7で日本語化する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/04/03/sublimetext3-japanese/"/>
    <updated>2014-04-03T17:24:05+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/04/03/sublimetext3-japanese</id>
    <content type="html"><![CDATA[<p>諸事情があってwindows7にて作業しなくちゃならなくなったので、<br/>
sublimetext3をインストール、日本語した。<br/>
けど、設定ファイルの場所がわからなったので、そのメモ。</p>

<!-- more -->


<p>基本はここの通り。<br/>
<a href="http://luna-plate.com/archives/4637">http://luna-plate.com/archives/4637</a></p>

<p>まずは、<a href="http://www.sublimetext.com/3">公式サイト</a>からインストール。<br/>
今回は64bitのwindows7なので、<br/>
<code>Windows 64 bit</code>を使用した。</p>

<p>で、手順通り、<a href="https://sublime.wbond.net/installation">package controlをインストール</a>。<br/>
その後、日本語化パッチをインストールして、手順にしたがってファイルを移動、リネーム。</p>

<p>この時の手順に表示されていた、</p>

<blockquote><ol>
<li>C:\Users\ユーザー名\AppData\Roaming\Sublime Text 3\Packages\Japanizeにインストールされている*.jpファイルを、</li>
</ol>
</blockquote>

<p>このディレクトリがどこにあるのかわからなかった。<br/>
結論を言うと、フォルダオプションで、隠しファイルなどを表示指定なかったことがそもそもの原因だった。</p>

<p><a href="http://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1361716208">AppDataの場所が見つけられません. windows7でコントロールパネル→デスクトップの…</a></p>

<ol>
<li>フォルダを開いた状態で、左上の「整理」メニューから、「フォルダーと検索のオプション」を開く。</li>
<li>「表示」タブの、「ファイルとフォルダーの表示」にある、「隠しファイル、隠しフォルダー、および隠しドライブを表示する」を選択して適用。</li>
<li>で、知恵袋にある通り、OS(C:) > ユーザー > (ユーザー名）> に行けばある。</li>
</ol>


<p>無事、手順どおりファイルを移動、リネームしたら、全メニューの日本語化が完了。</p>

<p>最後にShift-JISファイルを文字化けさせないように、package controlで<code>ConvertToUTF8</code>をインストールしておく。</p>

<p>(とはいえ、これでも日本語を使用すると高確率で文字化け状態で保存されてしまうけれど。。(sublimetextでは正しく表示できる))</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[phpstormで、ローカルファイルの差分]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/03/26/phpstorm-diff/"/>
    <updated>2014-03-26T10:29:07+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/03/26/phpstorm-diff</id>
    <content type="html"><![CDATA[<p>タイトル通り、<br/>
ローカルのファイルをPHPStormを使って差分チェックしたら死ぬほど便利だったのでメモ。</p>

<!-- more -->


<p>ファイルツリー上で２つのファイルを選択して、<code>⌘＋D</code>。</p>

<p>1) ファイルを選択して、</p>

<p><img src="http://kayakuguri.github.io/images/2014/03/diff-1.jpg" alt="Phpstrom diff" /></p>

<p>2) <code>⌘＋D</code>。</p>

<p><img src="http://kayakuguri.github.io/images/2014/03/diff-2.jpg" alt="Phpstrom diff" /></p>

<p>3) 差分の部分がハイライトされるので、<code>&gt;&gt;</code>か<code>&lt;&lt;</code>をクリックでそれぞれに反映される。</p>

<p><img src="http://kayakuguri.github.io/images/2014/03/diff-3.jpg" alt="Phpstrom diff" /></p>

<p>これで差分がたくさんある状態でもクリックのみで華麗に反映！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Visual Forceでのブラウザバック対策]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/03/20/sf-browser-back/"/>
    <updated>2014-03-20T10:50:36+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/03/20/sf-browser-back</id>
    <content type="html"><![CDATA[<p>salseforceでフォームを作成している際、<br/>
完了画面を表示させた後にブラウザで戻るボタンを押すと、<br/>
フォームや確認画面に戻ってしまい、更に入力した内容が表示されてしまう。</p>

<p>このまま何も対策を取っていないと、二重送信されてしまうおそれがあるので、<br/>
対策を考えてみた。</p>

<!-- more -->


<p>基本的な考え方は以下の通り。</p>

<p><a href="http://piyopiyocs.blog115.fc2.com/blog-entry-6.html">セッションとhistory.back()とブラウザの戻るボタン。</a></p>

<p>まずは、上記と同じように、一度送信が完了した段階で、<br/>
それとわかるフラグを立てておきます。<br/>
再度入力画面を表示させようとすると、このフラグが立った状態だとエラー画面へ遷移するように設定しておきます。</p>

<p>しかし、salseforceでデフォルトの設定のまま(?)作業すると、<br/>
戻るボタンを押した際には、キャッシュされたページが表示されます。<br/>
(入力された値も含めて)</p>

<p>なので、キャッシュを無効にして、ページが無条件で表示されないようにします。<br/>
入力ページの冒頭に以下の設定を入れます。</p>

<pre><code>&lt;apex:page . . .  cache="false" &gt;
</code></pre>

<p>こうすると、完了画面に遷移後、この入力ページへ戻ってくると、<br/>
「フォーム内容を再送信して下さい。」のような画面が表示され、リロードせざる得なくなります。<br/>
そうすることで、フラグを判定してエラーページへ遷移させることが出来ました。</p>

<hr />

<p>この事を調査している時に知ったのですが、<br/>
(基本的な事のようですが、)<br/>
<code>setRedirect</code>を利用すると、値を引き継ぐか、URLを変更するか、が選べるようです。</p>

<blockquote><p>画面遷移する際にPageReferenceのsetRedirect(false)を使用することで変数の値を引き継ぐことができます。<br/>
&ndash; <a href="http://tyoshikawa1106.hatenablog.com/entry/2013/05/03/234647">SFDC：2つのVFページと同一コントローラ</a></p></blockquote>

<p>デフォルトではfalseに設定されているようです。<br/>
なので、確認画面への遷移などでは、URLは変わらず、同一コントローラー内の値も引き継がれます。<br/>
しかし、完了画面への遷移の際は値は必要なく、URLも変わって欲しいので、上記をtrueで遷移させた方が良さそうです。</p>

<pre><code>//apexクラスの関数内で
return Page.FormComplete.setRedirect(true);
</code></pre>

<p>しかしこれをしてしまうと、最初に書いた判定用のフラグの値も引き継がれないので、<br/>
逆に値がなければエラー、という流れで作ったほうがいいかもしれません。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HTTP Live StreamingをFFmpegで作成する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/03/05/http-live-streaming/"/>
    <updated>2014-03-05T17:18:13+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/03/05/http-live-streaming</id>
    <content type="html"><![CDATA[<p>iOSで端末で動画をストリーミング再生させるべく、<br/>
HTTP Live Streamingを作成してみた。</p>

<!-- more -->


<blockquote><p>HTTP Live Streaming(HLS)は動画ファイルを約10秒程度の短時間に分割しMPEG-TSコンテナに入れたものをひたすら生成しつつm3u8形式のリストファイルにそのファイルを逐次追加していくことで、HTTPのみで擬似的にLive Streamingを実現する方法です。<br/>
Appleが提唱したらしく、iOSが最も安定して再生できるのですが一応Androidでも対応します。
(手元のNexus7で試した所、Androidだとシークが出来なくなる)
<a href="http://qiita.com/joker1007/items/def9d58ddb00fafc936d">http://qiita.com/joker1007/items/def9d58ddb00fafc936d</a></p></blockquote>

<p>作成するには、<a href="http://www.ffmpeg.org/">FFmpeg</a>を使うのが楽、とのことで、FFmpegをインストール。<br/>
新しめのFFmpegには分割するためのsegmenterも入っているようなので、FFmpegを入れるだけでOK。</p>

<p>インストール環境は、<code>Mac OS X 10.8.5</code></p>

<p>以下のページを参考にしてインストールした。</p>

<p><a href="http://kujirahand.com/blog/index.php?Mac+OS+X%E3%81%A7FFmpeg%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8WebM%E5%8B%95%E7%94%BB%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9">Mac OS XでFFmpegのインストールとWebM動画の作り方</a></p>

<p>インストールには、<a href="http://brew.sh/">Homebrew</a>を使用。<br/>
必要なプラグインをbrewを使用して入れていく。<br/>
(以下は1行)</p>

<pre><code>brew install automake celt faac fdk-aac git lame libass libtool
 libvorbis libvpx libvo-aacenc opencore-amr openjpeg opus sdl
 schroedinger shtool speex texi2html theora wget x264 xvid yasm
</code></pre>

<p>Xcodeが最新版でないとWarningが出るので、アップデートしておく。<br/>
(すでにインストール済みのものがある場合もwarningが出る。)</p>

<p>で、FFmpegをオプションつきでインストールする。<br/>
(以下も1行)</p>

<pre><code>brew install ffmpeg 
 --with-fdk-aac --with-libvo-aacenc 
 --with-libvorbis --with-libvpx --with-openjpeg 
 --with-theora --with-opencore-amr
</code></pre>

<p>これで準備は完了。</p>

<hr />

<p>以下を参考に変換、分割作業。</p>

<p><a href="http://qiita.com/joker1007/items/def9d58ddb00fafc936d">HTML5のvideoタグで利用するmp4の動画を作る時のTips</a><br/>
(以下は1行)</p>

<pre><code>ffmpeg -i test.mp4 -vcodec libx264
 -b:v 768k -s 640x360 -acodec libfaac
 -b:a 96k -ar 44100 -flags +loop-global_heade 
 -map 0 -bsf h264_mp4toannexb -f segment 
 -segment_format mpegts -segment_time 10 
 -segment_list index.m3u8 test%03d.ts
</code></pre>

<p>オプションの説明</p>

<table>
<thead>
<tr>
<th>コマンド </th>
<th> 値 </th>
<th> 説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-i </td>
<td> test.mp4 </td>
<td> 入力ファイル</td>
</tr>
<tr>
<td>-vcodec </td>
<td> libx264 </td>
<td> ビデオコーデック。h264</td>
</tr>
<tr>
<td>-b:v </td>
<td> 768k </td>
<td> ビデオビットレート</td>
</tr>
<tr>
<td>-acodec </td>
<td> libfaac </td>
<td> オーディオ・コーデック。AAC</td>
</tr>
<tr>
<td>-b:a </td>
<td> 96k </td>
<td> オーディオビットレート</td>
</tr>
<tr>
<td>-ar </td>
<td> 44100 </td>
<td> オーディオサンプリングレート</td>
</tr>
<tr>
<td>-flags </td>
<td> +loop-global_header </td>
<td> </td>
</tr>
<tr>
<td>-map </td>
<td> 0 </td>
<td> </td>
</tr>
<tr>
<td>-bsf </td>
<td> h264_mp4toannexb ※1 </td>
<td> ビデオフィルター</td>
</tr>
<tr>
<td>-f </td>
<td> segment </td>
<td> コマンドの指定</td>
</tr>
<tr>
<td>-segment_format </td>
<td> mpegts </td>
<td> 分割フォーマット</td>
</tr>
<tr>
<td>-segment_time </td>
<td> 10 </td>
<td> 分割秒数</td>
</tr>
<tr>
<td>-segment_list </td>
<td> index.m3u8 </td>
<td> リストファイル</td>
</tr>
</tbody>
</table>


<p>最後に出力ファイル名を記述。<code>%03d</code>は３桁の連番。<br/>
-flagsと-mapは詳細不明。</p>

<p>※1 <code>mpegts</code>形式にする場合、必要なフィルターのよう。</p>

<blockquote><p>h264_mp4toannexb :<br/>
Convert an H.264 bitstream from length prefixed mode to start code prefixed mode (as defined in the Annex B of the ITU-T H.264 specification).<br/>
This is required by some streaming formats, typically the MPEG-2 transport stream format (&ldquo;mpegts&rdquo;).<br/>
<a href="http://www.ffmpeg.org/ffmpeg-bitstream-filters.html">http://www.ffmpeg.org/ffmpeg-bitstream-filters.html</a></p></blockquote>

<p>HTMLにはこの場合、index.m3u8を読みこめば表示出来る。</p>

<pre><code>&lt;video controls poster="hoge.jpg" preload="none" onclick="this.play();" width="640" height="320" id="stageVideo"&gt;
    &lt;source src="index.m3u8"&gt;
    &lt;img src="hoge.jpg" alt="代替" width="640" height="320" /&gt;
&lt;/video&gt;
</code></pre>

<hr />

<p>参考サイト：<br/>
<a href="http://do-gugan.com/~furuta/archives/2013/03/http_live_strea.html">HTTP Live Streaming覚え書き</a><br/>
<a href="https://developer.apple.com/jp/devcenter/ios/library/documentation/StreamingMediaGuide.pdf">HTTP Live Streamingの概要(PDF)</a><br/>
<a href="http://blog.fumiz.me/2008/10/19/ffmpeg%E3%81%A7%E5%8B%95%E7%94%BB%E3%81%8B%E3%82%89%E7%94%BB%E5%83%8F%E3%82%92%E5%88%87%E3%82%8A%E5%87%BA%E3%81%99/">ffmpegで動画から画像を切り出す</a><br/>
<a href="http://yosilove.blogspot.jp/2011/04/mac-ffmpeg.html">[Mac] ffmpegをコンパイル</a><br/>
<a href="http://venture-blog.blogspot.jp/2012/05/http-live-streaming.html">HTTP Live Streamingを使ったサーバ構築</a><br/>
<a href="http://qiita.com/joker1007/items/def9d58ddb00fafc936d">HTML5のvideoタグで利用するmp4の動画を作る時のTips</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[apexからPOSTでファイルを送信する 改訂版]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/27/submit-base64/"/>
    <updated>2014-02-27T13:41:16+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/27/submit-base64</id>
    <content type="html"><![CDATA[<p><a href="http://kayakuguri.github.io/blog/2014/02/26/submit-callout-with-multipart/">前回のファイル送信</a>の動作確認版。</p>

<!-- more -->


<p>まず、やりたいこととして、<br/>
saleseforceで作成したページからファイルをherokuで作成したapiに送信して、<br/>
herokuのapiからそのファイルを添付で送信したかった。</p>

<p>結論としては以下の手順で動作した。</p>

<ol>
<li>visualforceで<code>apex:inputFile</code>を使用してファイルをアプロード</li>
<li>apexでファイルを受け取り、そのファイルを<code>base64エンコード</code>。</li>
<li>base64エンコードした文字列をPOSTのパラメータとして送信</li>
<li>herokuにアップしているphpでPOSTデータを受け取る</li>
<li>受け取ったbase64データをデコードして保存(一時的)</li>
<li>保存されたファイルからQdmailを使用してメールを送信</li>
</ol>


<hr />

<p>1) visualforceで<code>apex:inputFile</code>を使用してファイルをアプロード<br/>
visualforceページでのinputの書き方</p>

<pre><code>&lt;apex:input value="{!Email}" /&gt;
&lt;apex:inputFile value="{!FileBody}" filename="{!FileName}"/&gt;
</code></pre>

<p>2) apexでファイルを受け取り、そのファイルを<code>base64エンコード</code>。<br/>
3) base64エンコードした文字列をPOSTのパラメータとして送信<br/>
apex側で受け取る</p>

<pre><code>public String FileName { get; set; }
public Blob FileBody { get; set; }
public String Email { get; set; }

public Pagereference submit() {
    HttpRequest request = new HttpRequest();
    request.setEndpoint('送信先のphp');
    request.setMethod('POST');
    request.setHeader('Accept-Language', 'ja');
    //パラメータ
    Map&lt;String, String&gt; params = new Map&lt;String, String&gt;();
    params.put('to', Email);  //送信先
    params.put('attachName', FileName); //ファイル名
    params.put('attach', EncodingUtil.base64Encode(FileBody)); //ファイル内容
    Set&lt;String&gt; keys = params.keySet();
    String r = '';
    for(String key : keys) {
        //body用にパラメータを整形 to=xx&amp;attach=xx のように
        String val = params.get(key);
        r += key + '=';
        if(val != null) r += val;
        r += '&amp;';
    }
    r = r.removeEnd('&amp;');
    request.setBody(r);

    //送信
    Http http = new Http();
    HttpResponse response = http.send(request);
    ResResult = response.getBody(); //結果を受け取る
}
</code></pre>

<p>4) herokuにアップしているphpでPOSTデータを受け取る<br/>
5) 受け取ったbase64データをデコードして保存(一時的)<br/>
6) 保存されたファイルからQdmailを使用してメールを送信</p>

<p><a href="http://kayakuguri.github.io/blog/2014/02/18/php-heroku-sendattachmail/">Qdmailでの送信方法は以前の投稿を参照。</a></p>

<pre><code>require_once('../lib/qdmail.php');
require_once('../lib/qdsmtp.php');

//送信内容
$to          = $_POST['to'];
$subject     = '件名';
$body        = '本文';
$fromname    = '送り先名';
$fromaddress = '送り先アドレス';
$attachname  = $_POST['attachName'];
$attach      = $_POST['attach'];

$mail = new Qdmail();
$mail -&gt; smtp(true);
$param = array(
    'host'=&gt; $_ENV['MAILGUN_SMTP_SERVER'],
    'port'=&gt; $_ENV['MAILGUN_SMTP_PORT'],
    'from'=&gt; $fromaddress,
    'protocol'=&gt;'SMTP_AUTH',
    'user'=&gt; $_ENV['MAILGUN_SMTP_LOGIN'],
    'pass' =&gt; $_ENV['MAILGUN_SMTP_PASSWORD']
);
$mail -&gt;smtpServer($param);
$mail -&gt;to($to);
$mail -&gt;subject($subject);
$mail -&gt;from($fromaddress,$fromname);
$mail -&gt;text($body);

//添付ファイル
$bin = base64_decode(str_replace(' ', '+', $_POST['attach'][0])); //注意
$fp = fopen( "./" . $_POST['attachName'][0], "w" );
fwrite( $fp, $bin );
fclose( $fp );
$attach = array();
$attach[] = array( "./" . $_POST['attachName'][0] , $_POST['attachName'][0] );

//送信
echo $mail -&gt;send(); //成功の場合は「1」が返ってくる
</code></pre>

<p>Base64デコードしてファイルに保存する方法は以下を参考にしました。<br/>
<a href="http://blog.nipx.jp/archives/4137">Flashからアップロードする方法いろいろ</a><br/>
ただし、そのままではエラーになることがあるよう。</p>

<blockquote><p>どうやら、POSTでデータを渡すと、Base64の「+」記号が勝手にスペースに変換されてしまうらしい。<br/>
<a href="http://pontago.hatenablog.com/entry/20091028/1256743421">http://pontago.hatenablog.com/entry/20091028/1256743421</a></p></blockquote>

<p>(ヘッダ分を差し引く、の部分は無視しても問題なかった)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ApexからコールアウトでPOST送信する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/26/submit-callout-with-multipart/"/>
    <updated>2014-02-26T17:25:51+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/26/submit-callout-with-multipart</id>
    <content type="html"><![CDATA[<p>apexクラスからコールアウトを使って外部APIにPOST送信してみた。<br/>
ファイルも一緒に送信する。</p>

<!-- more -->


<p><strong>※追記</strong><br/>
実際にこの内容で送信してみると、壊れたファイルが送信されてしまいます。<br/>
原因を調査中です。<br/>
<strong>※追記 2/27</strong><br/>
<a href="http://kayakuguri.github.io/blog/2014/02/27/submit-base64/">動作したバージョンをアップしました。</a></p>

<h2>基本的なPOST送信の方法</h2>

<p>コールアウトで外部にHTTP送信する場合、<br/>
ヘッダーやボディの中身を順番に設定していき、送信、となる。<br/>
(この基本的な内容がわかっていなくて苦労した)</p>

<p>POSTやGETで送信されるデータの基本的な内容は以下。<br/>
<a href="http://www.yoheim.net/blog.php?q=20120611">[Web] HTTPリクエストの中身を学んでみた。GETやPOSTの違いなど</a></p>

<p>送信内容例はこんな感じ。(上記サイト内から引用)</p>

<pre><code>POST /www.hoge.com/test.php HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_4) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.54 Safari/536.5
Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5
Accept-Language: ja,en-us;q=0.7,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: Shift_JIS,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
Content-Type: text/plain
Content-Length: 23

key1=value1&amp;key2=value2
</code></pre>

<p>apexからの基本的なPOST送信の方法は以下。<br/>
<a href="http://ameblo.jp/hayapu/entry-11431469756.html">[Salesforce][Force.com]外部サイトにHTTPアクセス（Callout）する</a><br/>
(上記サイトから引用、編集)</p>

<pre><code>HttpRequest request = new HttpRequest();
request.setEndpoint('http://****アクセスしたいAPIのURLだよ！****');
request.setMethod('POSTとかGETとか！');
request.setHeader('Accept','text/plain, */*');
request.setHeader('Accept-Charset','Shift_JIS,utf-8;q=0.7,*;q=0.3');
request.setHeader('Accept-Encoding','gzip,deflate,sdch');
request.setHeader('Accept-Language','ja,en-US;q=0.8,en;q=0.6');
request.setHeader('Connection','keep-alive');
request.setHeader('Content-Type','text/xml; charset=UTF-8 ');
String prams = 'key1=value1&amp;key2=value2';
request.setBody(prams);

Http http = new Http();
HttpResponse response = http.send(request);
String responseBody = response..getBody();
</code></pre>

<p>最初に上げた送信内容のボディ部分に、getパラメータのようにつなげて書かれている。<br/>
なので、そのようにボディ部分に書いてやればいい。<br/>
<a href="http://www.kokyakukanri.info/salesforce/blog/2010/12/apexpost.html">[Apex]WebコールアウトでPOST送信する場合のパラメータの設定方法は？</a></p>

<p>注意点としては、コールアウトするURLは事前にドメインを指定しておく必要があるよう。<br/>
指定してないと、<code>Unauthorized endpoint, please check Setup-&gt;Security-&gt;Remote site settings.</code>とエラーが出る。</p>

<pre><code>設定 -&gt; セキュリティのコントロール -&gt; リモートサイトの設定
</code></pre>

<p>さらに、接続するURLはSSLでないとエラーが返されてしまう。<br/>
<code>The requested URL could not be retrieved</code></p>

<p>ちなみに、配列で送信する場合は以下。</p>

<pre><code>params = 'hoge[]=huga&amp;hoge[]=fuge';
request.setBody(params);
</code></pre>

<h2>POSTでファイルを送信する</h2>

<p>参考：<a href="http://salesforceafondo.wordpress.com/2013/01/08/post-multipartform-data-out-of-salesforce-com-with-apex/">Post ‘multipart/form-data’ out of Salesforce.com with APEX</a><br/>
スペイン語なので読めないけど、コード部分は読める。</p>

<p>そのまま送信すると、送信先のPHP側で、<code>$_FILES</code>にデータが入っていた。</p>

<p>この方法で、ファイルと一緒にパラメータも送信するには、<br/>
POST送信する際のボディ内容を再現すればいいよう。</p>

<p><a href="http://d.hatena.ne.jp/satox/20110726/1311665904">いまさら聞けないHTTPマルチパートフォームデータ送信</a><br/>
(上記内容から引用)</p>

<pre><code>POST test.php HTTP/1.1\r\n
Host: satoxpochi.com\r\n
Content-Type: multipart/form-data; boundary=---------------------------102852708831426\r\n
Content-Length: 「ボディ部のサイズ」\r\n
\r\n
-----------------------------102852708831426\r\n
Content-Disposition: form-data; name="password"\r\n
\r\n
ponpoko\r\n
-----------------------------102852708831426\r\n
Content-Disposition: form-data; name="level"\r\n
\r\n
high\r\n
-----------------------------102852708831426\r\n
Content-Disposition: form-data; name="filename"; filename="text.txt"\r\n
Content-Type: application/octet-stream\r\n
Content-Transfer-Encoding: binary\r\n
\r\n
abcd
-----------------------------102852708831426--\r\n
</code></pre>

<p>このように、送りたい情報分だけ区切り線でつないでいけばいい。<br/>
(１つのパラメータで区切り１つ分！)</p>

<p>また、visualforceのinputでfileを送信するには以下のようにする。</p>

<pre><code>[apexクラス]
public String FileName { get; set; }
public Blob FileBody { get; set; }

[visualforceページ]
&lt;apex:inputFile value="{!FileBody}" filename="{!FileName}"/&gt;
</code></pre>

<p>これで、<code>FileName</code>にファイル名、<code>FileBody</code>にファイルが入る。</p>

<p>これらを踏まえて、最終的な送信部分のソースは以下。<br/>
POSTでデータとファイルをコールアウトで送信する。</p>

<p>[Visualforceページ]</p>

<pre><code>メールアドレス1:&lt;apex:input value="{!Email1}" /&gt;&lt;br /&gt;
メールアドレス2:&lt;apex:input value="{!Email2}" /&gt;&lt;br /&gt;
&lt;br /&gt;
添付ファイル : &lt;apex:inputFile value="{!FileBody}" filename="{!FileName}"/&gt;
</code></pre>

<p>[apexクラス]</p>

<pre><code>HttpRequest request = new HttpRequest();
request.setEndpoint('https://送信先アドレス.php');
request.setMethod('POST');
request.setHeader('Accept-Language', 'ja');

String boundary = String.valueOf(DateTime.now().getTime());
String body = '';
body+='------------' + boundary + '\r\n';
body+='Content-Disposition: form-data; name="to[]"\r\n';
body+='\r\n';
body+=Email1 + '\r\n';
body+='------------' + boundary + '\r\n';
body+='Content-Disposition: form-data; name="to[]"\r\n';
body+='\r\n';
body+=Email2 + '\r\n';
body+='------------' + boundary + '\r\n';
body+='Content-Disposition: form-data; name="data"; filename="' + FileName + '"\r\n';
body+='Content-Transfer-Encoding: base64\r\n';
String contentType = 'application/octet-stream';
body+='Content-Type: ' + contentType + '\r\n\r\n';
body+=EncodingUtil.base64Encode(FileBody);
body+='\r\n------------' + boundary + '--';
request.setHeader('Content-Type', 'multipart/form-data; boundary=----------' + boundary);
request.setHeader('Content-Length',String.valueof(body.length()));
request.setBody(body);

Http http = new Http();
HttpResponse response = http.send(request);
ResResult = response.getBody();
</code></pre>

<p>送信先のPHPでの受信内容は以下。</p>

<pre><code>($_POST)
array(1) { 
    ["to"]=&gt; array(2) { 
        [0]=&gt; string(14) "mail1@hoge.com" 
        [1]=&gt; string(14) "mail2@huga.com"
    }
}

($_FILES)
array(1) { 
    ["data"]=&gt; array(5) { 
        ["name"]=&gt; string(8) "test.txt" 
        ["type"]=&gt; string(24) "application/octet-stream" 
        ["tmp_name"]=&gt; string(14) "/tmp/phpcEwVr6" 
        ["error"]=&gt; int(0) 
        ["size"]=&gt; int(309276) 
    }
}
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[PHP][heroku]Mailgun APIを使って添付ファイルを送る]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/19/attachment-use-mailgunapi/"/>
    <updated>2014-02-19T17:37:48+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/19/attachment-use-mailgunapi</id>
    <content type="html"><![CDATA[<p>以前に、<a href="http://kayakuguri.github.io/blog/2014/02/18/php-heroku-sendattachmail/">mailgunで添付ファイル付きメールを送る方法</a>を書いたが、<br/>
そちらは、<code>SMTP</code>バージョンで、今回はそのMailgun APIバージョン。</p>

<!-- more -->


<p>以下のファイルをダウンロードして一式アップしておく。<br/>
(readmeファイルなどいらないものが大量にあるが、とりあえず全部あげておく)</p>

<p><a href="https://9f67cbbd1116d8afb399-7760483f5d1e5f28c2d253278a2a5045.ssl.cf2.rackcdn.com/mailgun-php-1.7.zip">Library Download</a> (zip直リンク)</p>

<p>基本の送信方法は以下。<br/>
<a href="http://documentation.mailgun.com/quickstart.html#sending-messages">Sending Messages</a></p>

<pre><code># Include the Autoloader (see "Libraries" for install instructions)
require 'vendor/autoload.php';
use Mailgun\Mailgun;

# Instantiate the client.
$mgClient = new Mailgun('key-3ax6xnjp29jd6fds4gc373sgvjxteol0');
$domain = "samples.mailgun.org";

# Make the call to the client.
$result = $mgClient-&gt;sendMessage("$domain",
              array('from'    =&gt; 'Excited User &lt;me@samples.mailgun.org&gt;',
                    'to'      =&gt; 'Baz &lt;baz@example.com&gt;',
                    'subject' =&gt; 'Hello',
                    'text'    =&gt; 'Testing some Mailgun awesomness!'));
</code></pre>

<p>添付ファイルを送る方法は、<code>attachment</code>を使って、その中にファイル名を書く。<br/>
ファイル名を指定する方法が紹介されていた。<br/>
<a href="https://github.com/mailgun/mailgun-php/issues/35">https://github.com/mailgun/mailgun-php/issues/35</a></p>

<pre><code>array(
    'attachment' =&gt; array(
        'filePath' =&gt; './' . $attach['name'],
        'remoteName' =&gt; $attach['name']
    )
)
</code></pre>

<p>この方法で実装したところ、一時ファイルから添付ファイルにしての送信、が出来なかった。<br/>
(ファイルがないと怒られる)</p>

<p>試しに、heroku内で<code>move_uploaded_file</code>を使ってみると、エラーもなく保存出来た。<br/>
そのままそのファイルを添付して送ったところ、無事、送信完了。<br/>
ただしファイル自体は直接アクセスしようとすると<code>404</code>が表示されるので、<br/>
そのスクリプト内でのみ有効、のよう。</p>

<p>あと、上記の添付例のまま送信すると、2つ添付された。<br/>
どうやらファイル名を指定する箇所が効いておらず、書かれているファイル名が添付されたよう。<br/>
試しに、<code>'remoteName' =&gt; $attach['name']</code>の行を削除しても送信出来た。</p>

<p>その部分を考慮して、最終的に出来たコードが以下。</p>

<p>・1ファイルを1つの宛先に送信する場合<br/>
・送信先や内容などはPOSTで受け取る想定</p>

<pre><code>require '../vendor/autoload.php';
use Mailgun\Mailgun;
$mgClient = new Mailgun('key-xxx');
$domain = "appxxx.mailgun.org";

$attach = $_FILES["attach"]; //添付ファイル

//ファイル保存
try{
    $result = move_uploaded_file($attach['tmp_name'], './'.$attach['name']);
} catch (Exception $e) {
    var_dump($e-&gt;getMessage());
}

//メール送信
try {
    $result = $mgClient-&gt;sendMessage("$domain",
        array(
            'from'    =&gt; $_POST['fromname'].' &lt;'.$_POST['fromaddress'].'&gt;',
            'to'      =&gt; $_POST['toname'].' &lt;'.$_POST['to'].'&gt;',
            'subject' =&gt; $_POST['subject'],
            'text'    =&gt; $_POST['body']
        ),
        array(
            'attachment' =&gt; array(
                './' . $attach['name']
            )
        )
    );
    var_dump($result);

} catch (Exception $e) {
    var_dump($e-&gt;getMessage());
}               
</code></pre>

<p>結局、一度保存してからの送信、となるので、SMTPを使った方が処理が速いかも。(未検証)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[PHP][heroku]upload_max_filesizeを変更する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/18/change-max-filesize/"/>
    <updated>2014-02-18T17:02:20+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/18/change-max-filesize</id>
    <content type="html"><![CDATA[<p>herokuにて、<code>upload_max_filesize</code>を変更してみた。</p>

<!-- more -->


<p>初め、<code>ini_set</code>で変更しようとしてみたところ、<br/>
変更出来なかった。</p>

<pre><code>ini_set('upload_max_filesize', '6M');
</code></pre>

<p>参考：<a href="http://d.hatena.ne.jp/knowledgetree/20110217/1297939617">php.iniの設定を変えてもファイルをアップロードできないケース</a></p>

<p>調べてみると、変更出来るもの、出来ないものがあるらしく、<br/>
<code>upload_max_filesize</code>は、<code>ini_set()</code>では変更出来ないよう。</p>

<p><code>upload_max_filesize</code>は、<code>PHP_INI_PERDIR</code>となっていて、<br/>
php.ini、.htaccess、httpd.conf あるいは .user.ini (PHP 5.3 以降の場合) で設定可能なエントリ<br/>
となっている。<br/>
<a href="http://jp2.php.net/manual/ja/configuration.changes.modes.php">http://jp2.php.net/manual/ja/configuration.changes.modes.php</a></p>

<p>参考：PHP/ini_set()で変更できない値<br/>
<a href="http://hodade.adam.ne.jp/itmemo/index.php?PHP%2Fini_set()%A4%C7%CA%D1%B9%B9%A4%C7%A4%AD%A4%CA%A4%A4%C3%CD">http://hodade.adam.ne.jp/itmemo/index.php?PHP%2Fini_set()%A4%C7%CA%D1%B9%B9%A4%C7%A4%AD%A4%CA%A4%A4%C3%CD</a></p>

<p>herokuでは(たぶん).htaccessが使えない。<br/>
代わりに、<code>.user.ini</code>を試してみるとそちらで変更出来た。</p>

<p><code>.user.ini</code>ファイルを作成して、アップロード。<br/>
<strong>設置したディレクトリ内でのみ</strong>、有効になる。</p>

<p>[内容]</p>

<pre><code>upload_max_filesize = 6M
</code></pre>

<p>参考：<a href="http://yamanxworld.blogspot.jp/2009/12/php-53-htaccess-userini.html">PHP 5.3 の新機能: .htaccess の代わりになる .user.ini</a></p>

<hr />

<p><strong>追記</strong></p>

<p>上記の方法を取ったけれど、pnp.iniの設定ファイルを読み込ませる方法があった。<br/>
今回herokuにインストールしたbuildpackは、confというディレクトリ以下に設定ファイルを置けば<br/>
自動で認識されるような作りになっていたようです。</p>

<p>なので、conf以下に<code>php.ini</code>ファイルを置けば、いちいち各ディレクトリに設定ファイルを置かないでも大丈夫。</p>

<p>さらに、このbuildpackの環境は以下になっています。</p>

<ul>
<li>PHP 5.4.9（mbstring, mysql, pgsql, phpredis, mcryptなどなど）</li>
<li>nginx + php-fpm</li>
</ul>


<p>この、<code>nginx</code>というphpサーバはデフォルトではPOST出来るサイズが<code>1MB</code>になっているよう。<br/>
ここも変更しておかないとエラーになってしまう。</p>

<p><a href="http://qiita.com/notanota/items/4816ad71b90a9967fa18">nginxで&#8221;client intended to send too large body&#8221;が発生した時の対策方法</a></p>

<p>このnginxの設定ファイルは、<code>nginx.conf.erb</code>になるので、これも置いておく。<br/>
デフォルトの設定ファイルはそれぞれ以下にある。</p>

<ul>
<li><a href="https://raw.github.com/iphoting/heroku-buildpack-php-tyler/master/conf/php.ini">php.ini</a></li>
<li><a href="https://raw.github.com/iphoting/heroku-buildpack-php-tyler/master/conf/nginx.conf.erb">nginx.conf.erb</a></li>
</ul>


<p>php.iniの設定</p>

<pre><code>post_max_size = 8M
upload_max_filesize = 8M
</code></pre>

<p>nginxの設定</p>

<pre><code>http {
    client_max_body_size 1048576; # default 1M

    server {
        client_max_body_size 8M;
    }
}
</code></pre>

<p>参考：<a href="http://tkyk.name/blog/2012/11/28/php-on-heroku/">Heroku上に最新のPHP5.4 + Nginx環境を30秒で構築する</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[herokuでmb-string付きのPHP環境を作る]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/18/create-php-heroku-mbstring/"/>
    <updated>2014-02-18T10:57:30+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/18/create-php-heroku-mbstring</id>
    <content type="html"><![CDATA[<p>順番が前後しますが、mbstring付きのphp環境を作る方法をメモしておきます。</p>

<!-- more -->


<p>前提条件としては、heorkuのアカウントを持っていて、herokuコマンドが有効になっていて、<br/>
gitも使える状態、です。<br/>
<a href="http://devcenter.heroku.com/articles/heroku-command">Heroku Toolbelt</a>とかをインストールしておけば、herokuコマンドが使えるようになります。</p>

<p>参考：<a href="http://blog.infinity-dimensions.com/2012/01/heroku-toolbelt-install.html">Herokuコマンドを使えるようにするHeroku Toolbeltをインストール</a></p>

<hr />

<p>まずは、ディレクトリを作成しておき、そのディレクトリ内にgitを作成。<br/>
phpinfo()などだけ書いたテストのindex.phpを作成し、commitしておきます。</p>

<pre><code>$ mkdir myapp
$ cd myapp
$ git init
$ echo '&lt;?php phpinfo();' &gt; index.php
$ git add .
$ git commit -m 'initial commit'
</code></pre>

<p>で、herokuコマンドを使用して、phpをherokuで動かすためのプラグインである、&#8217;buildpack&#8217;をインストール。</p>

<pre><code>$ heroku create -s cedar -b git://github.com/iphoting/heroku-buildpack-php-tyler.git#php/5.4.9
</code></pre>

<p>ただし、このまま作成すると、heroku側で勝手に決められたアプリ名になってしまう。<br/>
後から名前を変更することは出来るが、リポジトリのURLを変更しないといけなかったりして、ちょっと面倒。<br/>
最初から名前を指定した上で作成するには、<code>heroku create myapp</code>とすればよい。<br/>
(名前は他のユーザーと被っているとダメ。また、アルファベットの大文字を使用しても怒られた。)<br/>
なので上記の分を名前指定で作成すると、以下。</p>

<pre><code>$ heroku create myapp -s cedar -b git://github.com/iphoting/heroku-buildpack-php-tyler.git#php/5.4.9
</code></pre>

<p>で、herokuにpush。<br/>
pushすると自動的にdeployもされるので、成功すればこれでmbstring付きのphp環境の作成は環境。</p>

<pre><code>$ git push heroku master
</code></pre>

<p>openするとページが表示される。</p>

<pre><code>$ heroku open
</code></pre>

<p>参考：<a href="http://d.hatena.ne.jp/hnw/20120603">HerokuのBuildpackを利用してmbstringが有効なPHPサーバを立ててみた</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[PHP]herokuで添付ファイル付きメールを送る]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/18/php-heroku-sendattachmail/"/>
    <updated>2014-02-18T10:38:12+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/18/php-heroku-sendattachmail</id>
    <content type="html"><![CDATA[<p>herokuで、POSTされたファイルを添付してメールを送信してみた。</p>

<!-- more -->


<p>環境は、PHPのmbstring環境。<br/>
メールは、Mailgun。</p>

<p>SMTPメールを送るためのライブラリは、QBMailを使用。<br/>
<a href="http://qiita.com/tsunet111/items/0ba0e8fc61882c3905c0">php から確実にメール送信（Qdmail使用、SMTP経由）</a></p>

<p>POSTから送信されたファイルは、<code>$_FILES</code>に保存される。<br/>
herokuでは、<a href="http://gihyo.jp/dev/serial/01/heroku/0011">ファイルの保存が出来ない</a>ので、<br/>
一時ファイルから添付することで実現する。</p>

<p>送信された一時ファイル : <code>$_FILES['xxx']['tmp_name']</code><br/>
ファイル名 : <code>$_FILES['xxx']['name']</code></p>

<p>以下、送信部分のソース。</p>

<pre><code>[HTML]
&lt;input type="file" name="upfile" /&gt;

[PHP]
$mail = new Qdmail();
$mail -&gt; smtp(true);
$param = array(
    'host'=&gt; $_ENV['MAILGUN_SMTP_SERVER'],
    'port'=&gt; $_ENV['MAILGUN_SMTP_PORT'],
    'from'=&gt; 'test@hoge.jp',
    'protocol'=&gt;'SMTP_AUTH',
    'user'=&gt; $_ENV['MAILGUN_SMTP_LOGIN'],
    'pass' =&gt; $_ENV['MAILGUN_SMTP_PASSWORD'],
);
$mail -&gt;attach(array($_FILES["upfile"]["tmp_name"], $_FILES["upfile"]['name'])); //添付ファイル
$mail -&gt;smtpServer($param);
$mail -&gt;to('送信先アドレス');
$mail -&gt;subject('件名');
$mail -&gt;from('送信元アドレス','送信元名');
$mail -&gt;text('本文');
$mail -&gt;send();
</code></pre>

<p>参考：<a href="http://hal456.net/qdmail/oopattach"> 添付ファイルの指定(OOP)</a></p>

<hr />

<p>　
　</p>

<p>以下、余談。</p>

<p>ファイルを送信する場合は、htmlのformタグに、<code>enctype="multipart/form-data"</code>をつけないといけない。</p>

<pre><code>&lt;form method="post" action="example.php" enctype="multipart/form-data"&gt;
</code></pre>

<p>jqueryを使ってajaxで実現したい場合は、enctypeは必要なく、<code>FormData</code>でまとめたデータを送信するようにし、<br/>
<code>contentType</code>と<code>processData</code>を<code>false</code>にする必要がある。</p>

<pre><code>var $form = $("form");
var fd = new FormData($form[0]);
// 送信
$.ajax({
    url: $form.attr('action'),
    type: $form.attr('method'),
    data: fd,
    contentType : false,
    processData : false,
    success: function(result) {
        console.log(result);
    },
    error: function(xhr, textStatus, error) {}
}
</code></pre>

<p>参考：<br/>
<a href="http://ginpen.com/2013/05/07/jquery-ajax-form/">jQueryでフォームをAjax送信する際の基本パターンのチュートリアル。二重送信の防御とか。</a><br/>
<a href="http://yokano-jp.blogspot.jp/2013/07/jqueryajax.html">jQuery.ajax() でファイルを送る</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHPでMailgunを使ってherokuでメール送信する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/17/send-mail-from-heroku-with-mailgun/"/>
    <updated>2014-02-17T11:31:07+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/17/send-mail-from-heroku-with-mailgun</id>
    <content type="html"><![CDATA[<p>herokuのphp環境でMailgunを使ってメール送信をしてみました。<br/>
ただし、日本語環境は入れなかったので、英語環境のみ。</p>

<!-- more -->


<p>まず、herokuにプラグインをインストールするためには、<br/>
クレジットカードの登録が必要なので、登録しておく。<br/>
(無料範囲内でのみでの利用でも必要)</p>

<p><a href="https://addons.heroku.com/#email-sms">Mail/SNSアドオン一覧</a></p>

<p>Mailgunの場合は、無料だと<code>300通/日</code>送れるよう。</p>

<p><a href="https://addons.heroku.com/mailgun">Mailgun</a></p>

<p>で、インストールすると、環境変数にSMTP情報が格納されるので、<br/>
そちらを利用して、メールを送れるようになる。<br/>
(<code>sendmail</code>関数は使えない。)</p>

<pre><code>$_ENV['MAILGUN_SMTP_SERVER'] = host
$_ENV['MAILGUN_SMTP_PORT'] = port
$_ENV['MAILGUN_SMTP_LOGIN'] = user
$_ENV['MAILGUN_SMTP_PASSWORD'] = password

$_ENV['MAILGUN_API_KEY'] = key
</code></pre>

<p>日本語環境だと、<code>Qdmail</code>というものが有名だそう。</p>

<p>参考：<a href="http://qiita.com/tsunet111/items/0ba0e8fc61882c3905c0">php から確実にメール送信（Qdmail使用、SMTP経由）</a></p>

<p>ただし、今回は<code>mbstring</code>環境を入れてないので、エラーが出てしまった。<br/>
なので、英語の解説ページを参考に、<code>phpmailer</code>を使ってみた。</p>

<pre><code>$mail = new PHPMailer;
$mail-&gt;isSMTP();
$mail-&gt;Host = $_ENV['MAILGUN_SMTP_SERVER'];
$mail-&gt;SMTPAuth = true;
$mail-&gt;Username = $_ENV['MAILGUN_SMTP_LOGIN'];
$mail-&gt;Password = $_ENV['MAILGUN_SMTP_PASSWORD'];
$mail-&gt;Port     = $_ENV['MAILGUN_SMTP_PORT'];
$mail-&gt;SMTPSecure = 'tls';
$mail-&gt;From = MAIL_FROM;
$mail-&gt;FromName = MAIL_FROM_NAME;

$mail-&gt;addAddress("hoge@exsample.jp");
$mail-&gt;addAddress("huga@exsample.com");

$mail-&gt;Subject = MAIL_SUBJECT;
$mail-&gt;Body    = MAIL_MSG1 . $body . MAIL_MSG2;
if(!$mail-&gt;send()){
    //falseが返ってくる場合はエラー。
    //送信完了の場合は、1が返ってくる。
}
</code></pre>

<p>ただし、もちろんだけど、日本語で送信すると文字化けする。<br/>
(Gmailの場合はなぜか本文は正しく表示出来た。件名は文字化けする)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Visual Forceでの送信ボタン2度押し防止策]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/12/vf-doubleclick-check/"/>
    <updated>2014-02-12T19:47:53+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/12/vf-doubleclick-check</id>
    <content type="html"><![CDATA[<p>salesforceでvisualforceの<code>commandButton</code>で、ボタンを連打すると、<br/>
送信が完了してページが遷移するまでに何度でもデータが送信されてしまう。</p>

<p>単純に、apexクラス内で２度目はinsertしない、とかにしてればいいのだけど、<br/>
それをvisualforceで完結させることが出来たので、メモ。</p>

<!-- more -->


<p><code>apex:commandButton</code>内で、<code>onclick</code>を使って、JSを呼んで、<br/>
１度目だと<code>true</code>、2度目だと<code>false</code>を返すようにする。<br/>
<code>true</code>が返って来た時だけ、<code>action</code>内の関数が実行される。</p>

<pre><code>//JS
&lt;script type="text/javascript"&gt;
var isSave = false;
function check(){
    if (!isSave) {
        isSave = true;
        return true;
    }
    return false;
}
&lt;/script&gt;

//HTML
&lt;apex:commandButton action="{!save}" onclick="return check();" image="{!URLFOR($Resource.remind, 'images/btn_send.gif')}" alt="OK" /&gt;
</code></pre>

<p>これで、連打しても大丈夫。</p>

<p>参考：<a href="http://blog.livedoor.jp/volvic_beer/archives/52301425.html">http://blog.livedoor.jp/volvic_beer/archives/52301425.html</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Visualforceページでカスタムコントローラーを指定する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/06/apex-page/"/>
    <updated>2014-02-06T13:00:31+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/06/apex-page</id>
    <content type="html"><![CDATA[<p>タイトルの通りだけのメモ。</p>

<!-- more -->


<p>visualforceのページ内の冒頭、<code>&lt;apex:page&gt;</code>内で、<br/>
<code>extensions="RemindController"</code>という風に指定する。</p>

<pre><code>&lt;apex:page standardController="Lead" extensions="CustomController" &gt;
</code></pre>

<p>この指定をしておくことで、<code>action</code>内で参照する関数は、指定したクラス内から呼び出されるようになる。</p>

<p>また、VisualForce内の冒頭、<code>apex:page</code>タグ内で、<code>action</code>を指定して、そこで関数を実行するようにする。<br/>
すると、ページアクセス時にまず呼び出されるようになる。</p>

<p>[VisualForce]</p>

<pre><code>&lt;apex:page standardController="Lead" action="{!checkKey}" &gt;
</code></pre>

<p>[apexクラス]</p>

<pre><code>public Pagereference checkKey(){
    if(/*処理*/){
        reutrn Page.xx;
    }else{
        return null;
    }
}
</code></pre>

<p>参考：<a href="http://www.kokyakukanri.info/salesforce/blog/2010/11/urlkey.html">ページを開いた段階でURLに含まれるKeyなどが不足している場合に、 別ページに遷移させる方法。</a></p>

<p>注意点としては、エラーページに遷移しなくていい場合には、<br/>
自身のページを指定してしまうと、無限ループに入って、内部サーバーエラー、となってしまう。<br/>
なので、遷移しなくていい場合は、<code>null</code>を返しておくと大丈夫なよう。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CodenvyとherokuでブラウザのみでRailsアプリを作成する その2]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/02/04/railsapp-on-codenvy-and-heroku-2/"/>
    <updated>2014-02-04T11:40:08+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/02/04/railsapp-on-codenvy-and-heroku-2</id>
    <content type="html"><![CDATA[<p>まずはそのままの状態でherokuにcommit、pushしてみる。</p>

<!-- more -->


<p>コミットして、、</p>

<p><img src="http://kayakuguri.github.io/images/2014/02/IDE1.jpg" alt="commit" /><br/>
<img src="http://kayakuguri.github.io/images/2014/02/IDE2.jpg" alt="commit" /></p>

<p>プッシュして。</p>

<p><img src="http://kayakuguri.github.io/images/2014/02/IDE3.jpg" alt="push" /><br/>
<img src="http://kayakuguri.github.io/images/2014/02/IDE4.jpg" alt="push" /></p>

<p>プッシュ先とユーザー名は複数ある場合は選べる。<br/>
現状は一つしかないので、そのまま。</p>

<p>少し待つと成功したので、heroku側でログを確認。<br/>
すると以下のような表示。</p>

<p><img src="http://kayakuguri.github.io/images/2014/02/heroku1.jpg" alt="heroku log" /></p>

<p>rubyアプリを使う準備がプッシュしたことによって構築されたみたい。<br/>
トップでの表示はこんな感じ。</p>

<p><img src="http://kayakuguri.github.io/images/2014/02/heroku2.jpg" alt="heroku top" /></p>

<p>現状、ページにアクセスすると以下のような表示になっている。</p>

<p><img src="http://kayakuguri.github.io/images/2014/02/ruby_site.jpg" alt="heroku page" /></p>

<blockquote><p>ただし、デフォルトではこれらのものはすべてセットで用意しないと動きません。<br/>
Controllerだけ作ればいいや、とはいかないのです。全部を用意して動かすのがRailsの基本なのです。<br/>
<a href="http://libro.tuyano.com/index3?id=790003">http://libro.tuyano.com/index3?id=790003</a></p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OpenFLをインストールしてみる]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/01/31/install-openfl/"/>
    <updated>2014-01-31T11:23:47+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/01/31/install-openfl</id>
    <content type="html"><![CDATA[<p>インストールした環境は、<code>MaxOS X 10.8.5</code></p>

<!-- more -->


<p>一つ前の記事で紹介した<a href="http://ics-web.jp/lab/archives/1329">参考記事</a>に<a href="https://plus.google.com/102594170131511973965/posts">池田さん</a>がアップしてくれているインストール方法の動画があるので、<br/>
基本それを見ればわかるのだけれど、一応、実際に作業してみたメモ。<br/>
デモ画面を起動するところまでやってみる。</p>

<hr />

<h4>Hexeをインストール</h4>

<p><a href="http://haxe.org/">Haxe(公式サイト)</a></p>

<p>ダウンロードページは以下。<br/>
<a href="http://haxe.org/download">ダウンロード</a><br/>
2014/1/31時点でのバージョンは、<code>3.0.1</code></p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl1.jpg" alt="Download haxe" /></p>

<p>インストーラーでインストール。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl2.jpg" alt="install haxe" /></p>

<p>後は、OpenFLのページに書いてある手順に従って、ターミナルからコマンドを打ち込んでいく。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl3.jpg" alt="Download openfl" /></p>

<h4>Limeをインストール</h4>

<p>OpenFLはLimeで動作しているので、Limeをまずはインストールする、との事。<br/>
以下のコマンドからインストール。</p>

<pre><code>$ haxelib install lime
</code></pre>

<p>うえの、install limeを実行すると、以下のように怒られた。</p>

<pre><code>This is the first time you are runing haxelib. Please run `haxelib setup` first
</code></pre>

<p>まずは、setupから実行しろ、と。<br/>
言われたとおりに実行。</p>

<p>すると、haxeのpathの入力を求められた。</p>

<pre><code>Please enter haxelib repository path with write access
Hit enter for default (/usr/lib/haxe/lib)
Path :
</code></pre>

<p>pathがわからないので一旦置いておく。<br/>
調べると、haxelibのセットアップはhaxeの公式ページに手順が載っていた。</p>

<p><a href="http://haxe.org/com/haxelib/setup">haxelib setup</a></p>

<p>ここでの手順をまずは試してみる。</p>

<pre><code>$ sudo mkdir -p /usr/lib/haxe/lib
$ sudo chown -R myusername /usr/lib/haxe
</code></pre>

<p>※パスはデフォルトでは、<code>/usr/lib/haxe/lib</code>。もし違ったらそのパスを入力。<br/>
また、<code>myusername</code>はPCのユーザー名を記入。</p>

<p>で、上記のsetupを実行。</p>

<pre><code>$ haxelib setup
</code></pre>

<p>pathには、先ほど作成したlibディレクトリを指定。</p>

<pre><code>/usr/lib/haxe/lib/
</code></pre>

<p><code>haxelib repository is now /usr/lib/haxe/lib/</code>と出れば大丈夫のよう。</p>

<p>ようやく冒頭のLimeのインストールへ戻る。</p>

<pre><code>$ haxelib install lime
</code></pre>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl4.jpg" alt="install lime" /></p>

<p>で、セットアップを実行</p>

<pre><code>$ haxelib run lime setup
</code></pre>

<p>lime commandをインストールするか聞かれる。<br/>
たぶん、必要っぽいので、<code>y</code>で。</p>

<pre><code>Do you want to install the "lime" command? [y/n/a] ? y
</code></pre>

<h4>OpenFLをインストール</h4>

<p>で、ようやっとOpenFLのインストール。</p>

<pre><code>$ lime install openfl
</code></pre>

<p>つらつらと色んなものが展開されて、無事、インストール成功。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl5.jpg" alt="install openfl" /></p>

<h4>各デバイス用セットアップ(オプション)</h4>

<p>それぞれのデバイス用のセットアップがオプションで用意されているよう。</p>

<pre><code>lime setup windows
lime setup android
lime setup blackberry
lime setup tizen
</code></pre>

<p>blackberryとtizenはいらないとしても、androidは入れとこうか。<br/>
windowsは、、微妙。<br/>
iOSはセットアップの必要はないけれど、Xcodeのインストールが必要、とのこと。</p>

<blockquote><p>Apple platforms don&rsquo;t require setup, but need Xcode to be installed.</p></blockquote>

<h5>Android用セットアップ</h5>

<p>とりあえず、androidのセットアップを実行。<br/>
SDKを入れるか、聞かれるので、yesで。</p>

<pre><code>$ lime setup android
Download and install the Android SDK? [y/n/a] ? y
</code></pre>

<p>アウトプットするディレクトリを聞かれたので、とりあえずデフォルト？のものを指定しておいた。<br/>
けど、そのディレクトリがないので事前に作成しておく。<br/>
作成は、haxeのセットアップ時を参考にして、ディレクトリ作成後、オーナーの変更もしておいた。<br/>
(必要ないかもしれないけれど)</p>

<pre><code>$ sudo mkdir -p /opt/android-sdk
$ sudo chown -R myusername /opt/android-sdk
</code></pre>

<p>で、改めて、アウトプットのディレクトリを指定。</p>

<pre><code>Output directory [/opt/android-sdk]: /opt/android-sdk
</code></pre>

<p>すると、<code>Android SDK Manager</code>なるものが立ち上がる。<br/>
つらつらと処理が進み、準備が整うと、パッケージをインストールするような待ちに入ったため、そのままインストール。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl6.jpg" alt="install android sdk" /></p>

<p>各ライセンスに同意が必要なため、<s>気にせず</s>目を通してから同意。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl7.jpg" alt="agree android sdk" /></p>

<p>次に、<code>android-ndk</code>をインストールしますか？と出た。<br/>
インストールしようとすると、ここでもディレクトリが必要。。。</p>

<pre><code>Download and install the Android NDK? [y/n/a] ? y
Output directory [/opt/android-ndk]: /opt/android-ndk
</code></pre>

<p>もちろんないので、再度、作成して、インストール。</p>

<p>参考：<a href="http://www.dm-android.com/column/ndk.html">コラム：Android NDKとは？Android NDKを学ぶメリット</a></p>

<p>次は、<code>Apatch Ant</code>。同じようにディレクリ作成。<br/>
(事前にこれだけいる、と言ってくれたらいいのに。。。)</p>

<pre><code>Download and install the apache ant? [y/n/a] ? y
Output directory [/opt/apache-ant]: /opt/apache-ant
</code></pre>

<p>参考：<a href="http://ja.wikipedia.org/wiki/Apache_Ant">Apache Ant &ndash; Wikipedia</a></p>

<p>で、Android SDKとNDKのパスを聞かれる。変更してないので、例のまま。</p>

<pre><code>Path to Android SDK [/opt/android-sdk]:/opt/android-sdk
Path to Android NDK [/opt/android-ndk]: /opt/android-ndk
</code></pre>

<p>これでようやっと終了(たぶん)。</p>

<h4>サンプルを実行</h4>

<p>ここからは、実行後にファイルが作成されるので、適当なディレクトリに移動してから実行する。<br/>
(デスクトップとか)</p>

<pre><code>$ lime create openfl:DisplayingABitmap
$ cd DisplayingABitmap
$ lime test neko
</code></pre>

<p>(<code>neko</code>とはmacのアプリのこと?)<br/>
サンプルどおり、nekoを起動させてみた状態は以下。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl8.jpg" alt="sample neko" /></p>

<p>このプログラムのまま、様々なプラットフォームで出力可能。<br/>
例えば、flashの場合は以下。</p>

<pre><code>$ lime test flash
</code></pre>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl9.jpg" alt="sample flash" /></p>

<p>最後に、ちょっと見栄えのするサンプルを実行させてみる。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl10.jpg" alt="HerokuShaders" /></p>

<p>DOCUMENTATION &ndash;> Samples &ndash;> HerokuShaders</p>

<pre><code>$ openfl create HerokuShaders
</code></pre>

<p>ページの通り、上記を実行すると、openflっていうコメンドがない、と言われたので、<br/>
上記の<code>lime</code>で、実行してみる。</p>

<pre><code>$ lime create openfl:HerokuShaders
$ cd HerokuShaders
$ lime test neko
</code></pre>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl11.jpg" alt="HerokuShaders" /></p>

<p>これもそれぞれ、flash、HTML5などで実行してみる。</p>

<pre><code>$ lime test flash
$ lime test html5
</code></pre>

<p>flashはエラーで実行できなかった。<br/>
何か必要なライブラリ？が入ってなかったよう。</p>

<pre><code>Error: Could not find sample "HerokuShaders" in project ""
</code></pre>

<p>HTML5はそのまま実行出来た。</p>

<p><img src="http://kayakuguri.github.io/images/2014/01/openfl12.jpg" alt="HerokuShaders in HTML5" /></p>

<p>ちょっと重かったけど、そのまま動いたのはすごい。<br/>
てか、このサンプルは何を使ってるんだろう？</p>

<h4>参考</h4>

<p>冒頭で上げた<a href="https://plus.google.com/102594170131511973965/pos]ts">池田さん</a>のインストール動画は以下。</p>

<iframe width="100%" height="315" src="http://kayakuguri.github.io//www.youtube.com/embed/MYHFJICUzzI" frameborder="0" allowfullscreen></iframe>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OpenFL？]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/01/31/openfl-search/"/>
    <updated>2014-01-31T10:39:01+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/01/31/openfl-search</id>
    <content type="html"><![CDATA[<p><strong><a href="http://www.openfl.org/">OpenFL</a></strong></p>

<p>OpenFLの記事が話題になっており、今回初めて知ったので、<br/>
ツイートベースに検索したメモ。</p>

<!-- more -->


<p>元は、<code>NME</code>という名前だったものが<code>OpenFL</code>に名前を変えたよう。<br/>
結構前からあるっぽい。<br/>
Haxe自体がワンソース・マルチユース的なものなのに、<br/>
そのHaxeを使ってOpenFLで開発、ってのはどいうこと？？<br/>
さらに便利に拡張したもの、とかなのかしら。</p>

<p><s>違う、Haxeライクな言語、であって、Haxeとは別ものっぽい。<br/>
とはいえ、Haxeのインストールも必要、っぽい。</s></p>

<p>下記、参考サイトにあった。</p>

<blockquote><p>OpenFLはプログラミング言語Haxeを使って開発する</p></blockquote>

<hr />

<h4>参考サイト</h4>

<p><a href="http://ics-web.jp/lab/archives/1329">クロスプラットフォーム開発の大本命!? HTML5もアプリもFlashも開発できる「OpenFL」とは？</a></p>

<p><a href="http://www.dango-itimi.com/blog/archives/2013/001188.html">Haxe OpenFL 調査</a></p>

<p><a href="http://d.hatena.ne.jp/wordi/20131107/p1">OpenFLで使えるGUIライブラリ</a></p>

<p><a href="http://bao-bao.info/blog/archive/2013/08/28/openfl_install/">OpenFLインストール</a></p>

<hr />

<h4>気になったツイートまとめ</h4>

<blockquote class="twitter-tweet" lang="ja"><p>Haxe（とOpenFL）は結局のところ、ワンソース・マルチユースではなく、ワンスタディ・マルチクリエイト、みたいなものなので、本当に厳密なところでは同一挙動でなくてもいいと思っているのではないかなー。</p>&mdash; 尾野（しっぽ） (@tail_y) <a href="https://twitter.com/tail_y/statuses/428926391619313664">2014, 1月 30</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p>FlashCCを使い素材管理し、JSFL経由でHaxeからOpenFLとCreateJSをを切り替えて利用するという、とんでもないワークフローは既に白玉さんが確立しているのです <a href="https://t.co/speVyDSv9x">https://t.co/speVyDSv9x</a> <a href="http://t.co/FG3dgktJB0">pic.twitter.com/FG3dgktJB0</a></p>&mdash; 尾野（しっぽ） (@tail_y) <a href="https://twitter.com/tail_y/statuses/428930765254979584">2014, 1月 30</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p>OpenFL の SWF Library(Free)ドキュメントページを閲覧するには Add cart にて支払い設定(住所入力)等を行う必要あり。ユーザ登録だけでは認証に弾かれます。 <a href="http://t.co/xYhqayB6CG">http://t.co/xYhqayB6CG</a></p>&mdash; siratama (@dango_itimi) <a href="https://twitter.com/dango_itimi/statuses/426696977712050177">2014, 1月 24</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p>あとOpenFLも低レベル層がLimeというのに分離してたり、h3dもHeapsという名前に変わる？とかいろいろ複雑ｗ　落ちついたら面白そう。</p>&mdash; こりん (@k0rin) <a href="https://twitter.com/k0rin/statuses/426576961721233408">2014, 1月 24</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p>OpenFL、人に勧めるにはまだ早い感してる。特にHTML5のバックエンドがDOMベースで速度出ないので。Haxe作者のh3d（Evolandに使われてる）に期待かなあ。</p>&mdash; こりん (@k0rin) <a href="https://twitter.com/k0rin/statuses/426574886643855361">2014, 1月 24</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p>OpenFLの続き。ちなみにWindowsネイティブアプリの出力にすると最もパフォーマンスが良い感じ。FlashやHTML5の6倍ほどのパフォーマンスが出ています。ちなみにNekoもなかなかパフォーマンスが良いです。 <a href="https://twitter.com/search?q=%23Haxe&amp;src=hash">#Haxe</a> <a href="http://t.co/x5wnV7BhZp">http://t.co/x5wnV7BhZp</a></p>&mdash; 池田 泰延 Yasunobu Ikeda (@clockmaker) <a href="https://twitter.com/clockmaker/statuses/425673916028170240">2014, 1月 21</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p><a href="https://twitter.com/iphone_dev_jp">@iphone_dev_jp</a> Haxe OpenFL(NME)を使って落ち物パズルゲームを作りました <a href="http://t.co/YjY12G6JY8">http://t.co/YjY12G6JY8</a></p>&mdash; Androwk (@Androwk) <a href="https://twitter.com/Androwk/statuses/362866716004454400">2013, 8月 1</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" lang="ja"><p>この間 OpenFL を試したら TextField を BitmapData に draw するところで何も描画されないって問題があった。詳しくは調べてない</p>&mdash; 馬鹿全903 (@bkzen) <a href="https://twitter.com/bkzen/statuses/353097125619437568">2013, 7月 5</a></blockquote>


<script async src="http://kayakuguri.github.io//platform.twitter.com/widgets.js" charset="utf-8"></script>

]]></content>
  </entry>
  
</feed>
