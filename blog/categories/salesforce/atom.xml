<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: salesforce | KayaMemo]]></title>
  <link href="http://kayakuguri.github.io/blog/categories/salesforce/atom.xml" rel="self"/>
  <link href="http://kayakuguri.github.io/"/>
  <updated>2014-10-06T18:29:19+09:00</updated>
  <id>http://kayakuguri.github.io/</id>
  <author>
    <name><![CDATA[萱潜]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[apigeeを使用してAPIの動作を確認する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/09/30/apigee/"/>
    <updated>2014-09-30T17:46:34+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/09/30/apigee</id>
    <content type="html"><![CDATA[<p>apigeeというサービスを使用すれば、様々なAPIの動作をブラウザ上から気軽に試せる、<br/>
ということなので実際に試してみました。</p>

<!-- more -->


<p><img src="/images/2014/09/apigee01.jpg" alt="apigee" /></p>

<p><a href="http://apigee.com/about/">apigee</a></p>

<p>トップページからAPIを試すサービスへの動線がわからなかったので、<br/>
以下から一覧ページに直接アクセスして下さい。<br/>
(サインアップすれば簡単にアクセス出来ます。)<br/>
(サインアップしなくても試すことは出来ます。)</p>

<p><a href="https://apigee.com/providers">API Providers</a></p>

<p>この一覧から各サービスのAPIに接続出来るわけですが、<br/>
今回はsalesforceのsandboxで試してみました。</p>

<p><img src="/images/2014/09/apigee02.jpg" alt="salesforce" /></p>

<p>クリックすると、APIの一覧ページに飛ぶので、とりあえず素通りしてコンソールへ。</p>

<p><img src="/images/2014/09/apigee03.jpg" alt="API Refarence" /></p>

<p>コンソール画面で実際に叩くAPIを指定したりパラメータを設定したり出来ます。<br/>
このままだと、認証がいらないものしか叩けないので、salesforceと認証させます。</p>

<p><code>Authentication</code>から、<code>OAuth2</code>を選択します。</p>

<p><img src="/images/2014/09/apigee04.jpg" alt="API Refarence" /></p>

<p>すると確認ダイアログが出ますので、<code>Sign in Salesforce Snadbox</code>をクリックしてログインし、認証させます。</p>

<p><img src="/images/2014/09/apigee05.jpg" alt="API Refarence" /></p>

<p>認証後は以下のようになります。</p>

<p><img src="/images/2014/09/apigee06.jpg" alt="API Refarence" /></p>

<p>GETの場合は、この状態で下の入力エリアに叩きたいAPIを入れ、<br/>
<code>?</code>でパラメータを設定していけば試すことができます。<br/>
POSTの場合は、以下のように、POSTに設定しAPIを入力します。</p>

<p><img src="/images/2014/09/apigee07.jpg" alt="API Refarence" /></p>

<p>しかしこのままではパラメータを入力出来ません。<br/>
なので、左側にある三角をクリックし、API一覧を表示させます。</p>

<p><img src="/images/2014/09/apigee08.jpg" alt="API Refarence" /></p>

<p>で、適当にAPIを選択すると、下図のようにタブが出現し、<br/>
その中の、<code>Body</code>でパラメータを設定する事が出来ます。<br/>
(ちなみにQueryではGETの値を設定出来ます)</p>

<p><img src="/images/2014/09/apigee09.jpg" alt="API Refarence" /></p>

<p>試しにこれはGETでversionを取得しただけですが、<br/>
実行すると以下の様な形でレスポンスを取得することができます。</p>

<p><img src="/images/2014/09/apigee10.jpg" alt="API Refarence" /></p>

<p>サインアップするとその他にも色々機能があるようで、もっと使い込めば便利かもしれません。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Salesforce]Mass Actionsでリードを一括編集]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/09/26/mass-edit-salesforce/"/>
    <updated>2014-09-26T14:44:48+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/09/26/mass-edit-salesforce</id>
    <content type="html"><![CDATA[<p>リードのリストビュー画面から抽出したリードを一括編集できるが、<br/>
そこで編集できる項目は限られている。<br/>
なので、好きな項目の編集を可能にするアドオンがあったのでご紹介。</p>

<p><a href="https://appexchange.salesforce.com/listingDetail?listingId=a0N30000003J6KcEAK">Mass Edit + Mass Update + Mass Delete &ndash; VersatileCapitalist, Inc &ndash; AppExchange</a></p>

<!-- more -->


<p>上記AppExchangeの画面から、<code>Get It Now!</code>をクリックして、インストールする。</p>

<p><img src="/images/2014/09/mass01.jpg" alt="Get It Now" /></p>

<p>ログインしていない場合は自身のアカウントでログイン。<br/>
sandboxかプロダクションへのインストールを選択。<br/>
今回はプロダクションへインストールした。</p>

<p><img src="/images/2014/09/mass02.jpg" alt="Install" /></p>

<p>内容を確認して、<code>Confilm and Install!</code>。<br/>
再度、ID、パスワードを聞かれるので、入力する。</p>

<p><img src="/images/2014/09/mass03.jpg" alt="Confilm and Install!" /></p>

<p>インストールする内容を確認して、<code>次へ</code>。</p>

<p><img src="/images/2014/09/mass04.jpg" alt="パッケージインストールの詳細" /></p>

<p>ユーザーごとの権限を設定し、<code>次へ</code>。</p>

<p><img src="/images/2014/09/mass05.jpg" alt="権限" /></p>

<p>セキュリティレベルを設定し、<code>次へ</code>。</p>

<p><img src="/images/2014/09/mass06.jpg" alt="セキュリティレベル" /></p>

<p>最後の確認をされるので、<code>インストール</code>。</p>

<p><img src="/images/2014/09/mass07.jpg" alt="インストール確認" /></p>

<p>少し待つと、インストールが完了。</p>

<p><img src="/images/2014/09/mass08.jpg" alt="インストール完了" /></p>

<p>使用するには、リードの<code>検索レイアウト</code>にMassActionのボタンを追加してやる必要がある。<br/>
<code>設定 -&gt; カスタマイズ -&gt; リード -&gt; 検索レイアウト</code>を開く。</p>

<p><img src="/images/2014/09/mass09.jpg" alt="リード検索レイアウト" /></p>

<p>その中の、<code>リードリストビュー</code>に追加するので、<code>編集</code>をクリック。</p>

<p><img src="/images/2014/09/mass10.jpg" alt="リードリストビュー" /></p>

<p>利用可能なボタン、の中にMassActionのボタンがあるので、<br/>
今回は全て選択して、追加し、保存。</p>

<blockquote><p>Mass Delete<br/>
Mass Edit<br/>
Mass Update</p></blockquote>

<p><img src="/images/2014/09/mass11.jpg" alt="リードリストビューの編集" /></p>

<p>後は通常通り、リードからビューを選択する。<br/>
新規ビューを作成するときに、<code>表示する項目を選択</code>できるが、<br/>
ここで選択したものが後で更新出来る項目となる。</p>

<p><img src="/images/2014/09/mass12.jpg" alt="表示する項目" /></p>

<p>リストビューを表示すると、上部に先程追加したMassのボタンが表示されている。<br/>
変更したいリードをチェックボックスで選択し、その上部のボタン、今回は<code>Mass Edit</code>をクリック。</p>

<p><img src="/images/2014/09/mass13.jpg" alt="Mass Edit" /></p>

<p>選択したリードがリストで表示されるので、変更したい箇所を編集し、saveをクリックすると反映される。<br/>
今回は<code>会社名</code>を変更してみた。</p>

<p><img src="/images/2014/09/mass14.jpg" alt="編集" /></p>

<p>結果が反映される。</p>

<p><img src="/images/2014/09/mass15.jpg" alt="結果" /></p>

<p>このように、リードの項目をまとめて編集したりする場合にはこれは非常に便利だと思う。<br/>
いちいち詳細、編集画面に遷移しなくてよいので楽。</p>

<h3>参考</h3>

<p><a href="http://synergylead.jp/support/faq-salesforce-mass-update-edit-delete/">一覧表示画面からチェックボックスで選択して削除・更新を行うには？｜Synergy!LEAD</a><br/>
<a href="https://www.youtube.com/watch?v=xZCyhuTmaWE">Mass Edit and Mass Update in Salesforce.com &ndash; YouTube</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[SalesForce]キャンペーンメンバーの状況を追加する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/09/12/campaignmemberstatus/"/>
    <updated>2014-09-12T11:40:25+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/09/12/campaignmemberstatus</id>
    <content type="html"><![CDATA[<p>キャンペーンメンバーオブジェクトのデフォルト項目である、<br/>
<code>状況</code>は、デフォルトでは、</p>

<blockquote><p>送信<br/>
レスポンスあり</p></blockquote>

<p>の２つになっている。<br/>
これを独自で追加したい。</p>

<!-- more -->


<p>結論から言うと、仕様上、無理だった。<br/>
以下に同じような質問があった。</p>

<p><a href="https://developer.salesforce.com/forums/ForumsMain?id=906F00000009B5HIAU">キャンペーンメンバーの状況に値を追加したい &ndash; Salesforce Developer Community</a></p>

<blockquote><p>レコードを横断した設定ではなく、キャンペーンレコード毎に状況を設定する必要があります。</p></blockquote>

<ol>
<li>キャンペーンタブから、状況を追加したいキャンペーンレコードの詳細画面を表示</li>
<li>「高度な設定」ボタン押下</li>
<li>メンバーの状況の値の「編集」ボタン押下</li>
<li>メンバー状況の一番下にある、「さらに追加」リンク押下</li>
</ol>


<p>この仕様は謎仕様としても有名？なよう。</p>

<blockquote><p>キャンペーンメンバーの「状況」のクソ仕様(?)を質問した。<br/>
デフォルト値を変更できない件となぜか手入力な仕様について。<br/>
キャンペーンを作るたびに「状況」の選択肢を追加しないとダメな上に、手入力だから後からの集計がヒドイことになる。<br/>
<a href="https://twitter.com/realichiro5221/status/337413167804203009">https://twitter.com/realichiro5221/status/337413167804203009</a></p></blockquote>

<p>解決策としては、同じ<code>状況</code>項目をカスタム項目として作成するしかないよう。<br/>
それでもデフォルトの<code>状況</code>は必須項目になるので、運用がややこしくなりそうだけれど。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SOQLクエリの結果をJSONで出力する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/09/09/create-json-in-apex/"/>
    <updated>2014-09-09T15:54:29+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/09/09/create-json-in-apex</id>
    <content type="html"><![CDATA[<p>SOQLで取得したクエリ内容をJSONにパースして出力する方法。</p>

<!-- more -->


<p>Apexクラス</p>

<pre><code>public class sample
{
    public String text1 {get;set;}

    public sample()
    {

    }    
    public void parseJson()
    {
        String soql = 'SELECT Name FROM Lead';
        List&lt;Account&gt; acct = Database.Query(soql); 
        text1 = JSON.serialize(acct);
    }    
} 
</code></pre>

<p>VisualForceページ</p>

<pre><code>&lt;apex:page showHeader="false" controller="ShowCampaignListController" action="{!parseJson}"&gt;
    {!text1}
&lt;/apex:page&gt;
</code></pre>

<p>出力結果例</p>

<pre><code>[{
    "attributes":
    {
        "type":"Lead",
        "url":"/services/data/v32.0/sobjects/Lead/00QO0000002xxxxxxx"
    },
    "Name":"テストユーザー3",
    "Id":"00QO0000002xxxxxxx"
},
{
    "attributes":
    {
        "type":"Lead",
        "url":"/services/data/v32.0/sobjects/Lead/00QO0000002ooooooo"
    },
    "Name":"テストユーザー2",
    "Id":"00QO0000002ooooooo"
}]
</code></pre>

<p>参考：<a href="http://www.infallibletechie.com/2012/10/generating-json-in-visualforce-page-in.html">Infallible Techie: Generating JSON in Visualforce page in Salesforce</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[SalesForce]ApexでカスタムREST APIを作成する]]></title>
    <link href="http://kayakuguri.github.io/blog/2014/09/08/apex-restapi/"/>
    <updated>2014-09-08T22:30:35+09:00</updated>
    <id>http://kayakuguri.github.io/blog/2014/09/08/apex-restapi</id>
    <content type="html"><![CDATA[<p>apexにて、自作のRestAPIを作成してみました。<br/>
そして、作成したAPIをPHPから叩いてみました。</p>

<!-- more -->


<p>まずは、Salesforce側の設定。<br/>
今回は、GETで指定されたIDのリードデータを取得するもの。</p>

<pre><code>@RestResource(urlMapping='/CustomLead/*')
global with sharing class CustomLeadSample {
    @HttpGet
    global static sObject doGet() {
        RestRequest req = RestContext.request;
        Id LeadID = req.params.get('id');
        try {
            Lead acc = [SELECT Id, Name FROM Lead WHERE Id = :LeadID LIMIT 1];
            return acc;
        } catch (exception e) {
            return null;
        }
    }
}
</code></pre>

<p>公式の解説の最後に載っているものほぼそのままです。<br/>
<a href="https://developer.salesforce.com/page/Creating_REST_APIs_using_Apex_REST">Creating REST APIs using Apex REST &ndash; developer.force.com</a></p>

<p>で、これをPHP側から呼び出します。<br/>
oauth認証は以下の記事のものを使用させてもらっています。<br/>
<a href="http://www.nkjmkzk.net/?p=2328">nkjmkzk.net &raquo; 新しくなったForce.com OAuth Toolkit for phpの使い方 のコメントのフィード</a><br/>
<a href="https://github.com/nkjm/Force.com-OAuth-Toolkit-for-PHP">nkjm/Force.com-OAuth-Toolkit-for-PHP</a></p>

<p><code>@RestResource</code>で作成したAPIは、<code>/services/apexrest/</code>から始まるURLで定義されています。<br/>
また、外部から接続する場合には、<code>接続アプリケーション</code>の設定が必要になります。<br/>
<a href="https://help.salesforce.com/HTViewHelpDoc?id=connected_app_create.htm&amp;language=ja">接続アプリケーションの作成</a><br/>
コールバックURLは今回は必要ないので、適当なローカルURLを指定しています。<br/>
また、パスワードは、(特定のIPアドレスからのアクセスに制限しなかった場合には)<br/>
パスワード＋セキュリティトークン、の形で渡す必要があります。</p>

<pre><code>require_once('sf_oauth.php');
$app_token = 'xxx';
$app_secret = 'xxx';
$app_callback = 'http://localhost:9000/';
$sf_id = 'xxx';
$sf_pass = 'password+security-token';

$oauth = new oauth($app_token, $app_secret, $app_callback);
$oauth-&gt;auth_with_password($sf_id, $sf_pass);

$url = "$oauth-&gt;instance_url/services/apexrest/CustomLead/?id=".'リードのID';
$curl = curl_init($url);
curl_setopt($curl, CURLOPT_HEADER, false);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HTTPHEADER,
    array("Authorization: OAuth $oauth-&gt;access_token",
        "Content-type: application/json"));
$json_response = curl_exec($curl);
$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);
</code></pre>

<p>レスポンスは以下のような形です。</p>

<pre><code>{
    "attributes":
    {
        "type":"Lead",
        "url":"/services/data/v32.0/sobjects/Lead/ユーザーID"
    },
    "Name":"ユーザー名",
    "Id":"ユーザーID"
}
</code></pre>

<p>参考サイト：<br/>
<a href="http://magnet88jp.hateblo.jp/entry/2014/07/09/105848">Salesforce 外部サイトからApexメソッドを呼び出したい &ndash; まぐねっとのブログ</a></p>
]]></content>
  </entry>
  
</feed>
